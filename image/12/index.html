<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Image view — Gallery</title>
  <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@400;700&display=swap" rel="stylesheet">
  <style>
:root{
  --bg-color:#181820;
  --text-color:#fff;
  --accent:#39d353;
  --subtle:#b0b0b0;
  --card-bg: rgba(8,8,10,0.55);
  --card-border: rgba(57,211,83,0.18);
  --glass-blur: 6px;
  --card-radius:18px;
}

/* Reset + base */
*{box-sizing:border-box;margin:0;padding:0}
html,body{height:100%}
body{
  font-family:'Roboto Mono', monospace;
  color:var(--text-color);
  background: linear-gradient(to bottom, #000000, var(--bg-color));
  overflow-x:hidden;
  line-height:1.5;
  position:relative;
}

/* Canvas sits behind everything */
#bg-canvas{position:fixed;top:0;left:0;width:100%;height:100%;z-index:1;pointer-events:none}

/* Top-left external portfolio button (fixed) */
.portfolio-btn{
  position:fixed;
  left:18px;
  top:18px;
  z-index:5;
  display:inline-flex;
  align-items:center;
  justify-content:center;
  gap:8px;
  padding:10px 14px;
  border-radius:10px;
  border:1.6px solid var(--card-border);
  background:var(--card-bg);
  color:var(--text-color);
  text-decoration:none;
  font-weight:700;
  box-shadow:0 8px 30px rgba(0,0,0,0.45);
}

/* Centered viewer area */
.center-wrap{min-height:100vh;display:flex;align-items:center;justify-content:center;padding:28px;z-index:3;position:relative}
.viewer-container{
  width:min(1400px, 92vw);
  aspect-ratio:2/1;
  background:var(--card-bg);
  border-radius:28px;
  border:1.5px solid var(--card-border);
  padding:20px;
  position:relative;
  box-shadow:0 18px 60px rgba(0,0,0,0.6);
  backdrop-filter: blur(var(--glass-blur));
  display:flex;
  flex-direction:column;
}

/* top row: back button (left) + socials (right) */
.viewer-top{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:12px;
  padding:6px 4px;
}
.viewer-top .back-inner{
  display:flex;align-items:center;gap:8px;
}
.btn-icon{
  display:inline-flex;align-items:center;justify-content:center;
  width:48px;height:44px;border-radius:10px;border:1.6px solid var(--card-border);
  background:transparent;cursor:pointer;color:var(--text-color);
}
.viewer-socials{display:flex;gap:10px;align-items:center;margin-left:auto}
.viewer-socials a{
  width:44px;height:44px;border-radius:10px;border:1.6px solid var(--card-border);
  display:inline-flex;align-items:center;justify-content:center;background:transparent;text-decoration:none;color:var(--text-color);
}

/* central image area */
.viewer-middle{
  flex:1 1 auto;display:flex;align-items:center;justify-content:center;position:relative;
  margin-top:8px;margin-bottom:8px;
}
.image-frame{
  width:90%;
  aspect-ratio:13/6;
  border-radius:14px;
  background:rgba(0,0,0,0.08);
  display:flex;align-items:center;justify-content:center;
  overflow:hidden;border:1px solid rgba(255,255,255,0.03);
}
.image-frame img{
  width:100%;height:100%;object-fit:contain;display:block;background:transparent;
}

/* left/right nav arrows (center vertically) */
.nav-left, .nav-right{
  position:absolute;top:50%;transform:translateY(-50%);
  display:inline-flex;align-items:center;justify-content:center;
  width:56px;height:56px;border-radius:10px;border:1.6px solid var(--card-border);
  background:var(--card-bg);cursor:pointer;color:var(--text-color);z-index:4;
  box-shadow:0 10px 24px rgba(0,0,0,0.45);
}
.nav-left { left: calc(5% - 70px); }  /* push it more to the left */
.nav-right { right: calc(5% - 70px); } /* push it more to the right */

/* bottom row: download on bottom-right inside container */
.viewer-bottom {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding-top: 6px;
}

.download-btn{
  display:inline-flex;align-items:center;justify-content:center;
  width:56px;height:56px;border-radius:10px;border:1.6px solid var(--card-border);
  background:transparent;color:var(--text-color);cursor:pointer;
}

.fullscreen-btn {
  display:inline-flex;
  align-items:center;
  justify-content:center;
  width:56px;
  height:56px;
  border-radius:10px;
  border:1.6px solid var(--card-border);
  background:transparent;
  color:var(--text-color);
  cursor:pointer;
}

@media (max-width:560px){
  .fullscreen-btn{width:48px;height:48px}
}


/* small helper text */
.meta-line{color:var(--subtle);font-size:.95rem;text-align:center;margin-top:8px}

/* accessibility focus */
.btn-icon:focus, .viewer-socials a:focus, .nav-left:focus, .nav-right:focus, .download-btn:focus{
  outline:3px solid rgba(57,211,83,0.12);
  outline-offset:2px;
}

/* Responsive */
@media (max-width:900px){
  .image-frame{width:86%}
  .nav-left{left:2%}
  .nav-right{right:2%}
}
@media (max-width:560px){
  .viewer-container{width:94vw;border-radius:14px;padding:12px}
  .btn-icon{width:44px;height:40px}
  .viewer-socials a{width:36px;height:36px}
  .nav-left,.nav-right,.download-btn{width:48px;height:48px}
}
  </style>
</head>
<body>
  <!-- background canvas (optional animated hexgrid) -->
  <canvas id="bg-canvas" aria-hidden="true"></canvas>

  <!-- top-left portfolio button (external) -->
  <a class="portfolio-btn" id="portfolioBtn" href="https://rio.box" target="_blank" rel="noopener noreferrer">
    <!-- small left arrow icon + text -->
    <svg width="16" height="16" viewBox="0 0 24 24" aria-hidden focusable="false">
      <path d="M15 18l-6-6 6-6" stroke="#39d353" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" fill="none"/>
    </svg>
    Portfolio
  </a>

  <!-- centered viewer -->
  <main class="center-wrap" role="main">
    <section class="viewer-container" aria-labelledby="viewerLabel">
      <div class="viewer-top">
        <div class="back-inner">
          <button class="btn-icon" id="backScreen" title="Back to search" aria-label="Back to previous screen">
            <!-- inside-container back arrow -->
            <svg width="20" height="20" viewBox="0 0 24 24" aria-hidden><path d="M15 6l-6 6 6 6" stroke="#39d353" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" fill="none"/></svg>
          </button>
        </div>

        <div class="viewer-socials" id="viewerSocials" aria-hidden="false" title="My socials">
          <!-- placeholder social icons. Replace src with your /images/*.svg -->
          <a class="social" href="javascript:alert('This feature is not ready yet.');" target="_blank" rel="noopener noreferrer" title="Light Dark Mode">
            <img src="/logo/lightdarkmode.svg" alt="YouTube" style="width:24px;height:24px;display:block">
          </a>
          <a class="social" href="javascript:alert('This feature is not ready yet.');" target="_blank" rel="noopener noreferrer" title="Brightness">
            <img src="/logo/brightness.svg" alt="Discord" style="width:24px;height:24px;display:block">
          </a>
          <a class="social" href="javascript:alert('This feature is not ready yet.');" target="_blank" rel="noopener noreferrer" title="Assets">
            <img src="/logo/assets.svg" alt="X" style="width:22px;height:22px;display:block">
          </a>
          <a class="social" href="javascript:alert('This feature is not ready yet.');" target="_blank" rel="noopener noreferrer" title="Sauce">
            <img src="/logo/sauce.svg" alt="Reddit" style="width:22px;height:22px;display:block">
          </a>
          <a class="social" href="javascript:alert('This feature is not ready yet.');" title="Info">
            <img src="/logo/info.svg" alt="Email" style="width:20px;height:20px;display:block">
          </a>
        </div>
      </div>

      <div class="viewer-middle" aria-live="polite">
        <button class="nav-left" id="prevBtn" title="Previous image" aria-label="Previous image">
          <!-- left arrow -->
          <svg width="22" height="22" viewBox="0 0 24 24" aria-hidden><path d="M15 18l-6-6 6-6" stroke="#39d353" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round" fill="none"/></svg>
        </button>

        <div class="image-frame" id="imageFrame">
          <img id="mainImage" alt="Selected image" src="image.png" />
        </div>

        <button disabled class="nav-right" id="nextBtn" title="Next image" aria-label="Next image">
          <!-- right arrow -->
          <svg width="22" height="22" viewBox="0 0 24 24" aria-hidden><path d="M9 6l6 6-6 6" stroke="#39d353" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round" fill="none"/></svg>
        </button>
      </div>

      <div class="viewer-bottom">
  <button class="fullscreen-btn" id="fullscreenBtn" title="View image in fullscreen" aria-label="View image in fullscreen">
    <!-- fullscreen icon -->
    <svg width="20" height="20" viewBox="0 0 24 24" aria-hidden>
      <path d="M8 3H5a2 2 0 0 0-2 2v3m0 6v3a2 2 0 0 0 2 2h3m6-14h3a2 2 0 0 1 2 2v3m0 6v3a2 2 0 0 1-2 2h-3" stroke="#39d353" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round" fill="none"/>
    </svg>
  </button>

  <button class="download-btn" id="downloadBtn" title="Download image" aria-label="Download image">
          <!-- download icon -->
          <svg width="20" height="20" viewBox="0 0 24 24" aria-hidden><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" stroke="#39d353" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round" fill="none"/><path d="M7 10l5 5 5-5" stroke="#39d353" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round" fill="none"/><path d="M12 15V3" stroke="#39d353" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round" fill="none"/></svg>
        </button>
      </div>

      <div class="meta-line" id="metaLine">ID: <span id="metaId">—</span> &middot; <span id="metaTitle">No image selected</span></div>
    </section>
  </main>

  <script>
  /***********************
   * Utility: extract image id from URL
   * supports:
   * - /image/123 (path segment)
   * - /repo/image/123 (last segment after "image")
   * - ?id=123
   * - #123
   ***********************/
  function getImageIdFromLocation() {
    const p = location.pathname.replace(/\/+$/,'').split('/').filter(Boolean);
    // look for segment "image" then next segment
    for (let i = 0; i < p.length; i++) {
      if (p[i].toLowerCase() === 'image' && p[i+1]) return p[i+1];
    }
    // fallback: last segment might be number
    if (p.length) {
      const last = p[p.length-1];
      if (/^\d+$/.test(last)) return last;
    }
    // query param
    const qp = new URLSearchParams(location.search).get('id');
    if (qp) return qp;
    // hash
    if (location.hash) {
      const h = location.hash.replace('#','');
      if (h) return h;
    }
    return null;
  }

  /***********************
   * Images data
   * Replace these sample URLs with your imgbb direct links
   * keys are ids that will be used in the URL: /image/1, /image/2 ...
   ***********************/
  const imagesData = {
    "1": { url: "image.png", title: "Sunset beach" }
  };

  // elements
  const mainImage = document.getElementById('mainImage');
  const metaId = document.getElementById('metaId');
  const metaTitle = document.getElementById('metaTitle');
  const prevBtn = document.getElementById('prevBtn');
  const nextBtn = document.getElementById('nextBtn');
  const downloadBtn = document.getElementById('downloadBtn');
  const backScreen = document.getElementById('backScreen');

  // compute numeric-ish id
  function normalizeId(id) {
    // if numeric string, parse; otherwise keep as string
    if (/^\d+$/.test(String(id))) return String(parseInt(id,10));
    return String(id);
  }

  function setViewForId(rawId, pushHistory=false) {
    const id = normalizeId(rawId);
    if (!id || !imagesData[id]) {
      mainImage.src = 'image.jpg';
      metaId.textContent = '—';
      metaTitle.textContent = 'Image not found';
      prevBtn.disabled = true;
      nextBtn.disabled = true;
      downloadBtn.disabled = true;
      // optionally show a placeholder
      mainImage.alt = 'No image available';
      return;
    }

    const data = imagesData[id];
    mainImage.src = data.url;
    mainImage.alt = data.title || ('Image ' + id);
    metaId.textContent = id;
    metaTitle.textContent = data.title || '';

    // prev/next buttons: try to treat ids as numeric if possible
    const numeric = /^\d+$/.test(id);
    if (numeric) {
      const num = parseInt(id,10);
      prevBtn.disabled = !imagesData[String(num-1)];
      nextBtn.disabled = !imagesData[String(num+1)];
    } else {
      // if non-numeric ids, disable prev/next by default
      prevBtn.disabled = true;
      nextBtn.disabled = true;
    }

    // update location but keep friendly to GitHub pages (use history API)
    if (pushHistory) {
      // create a clean path: replace last segment with /image/{id}
      const base = location.pathname.replace(/\/+$/,'');
      // If current pathname already ends with /image/... replace it; otherwise append
      let newPath;
      const parts = base.split('/').filter(Boolean);
      const idx = parts.indexOf('image');
      if (idx >= 0) {
        parts.splice(idx+1); // keep upto image
        newPath = '/' + parts.join('/') + '/image/' + encodeURIComponent(id);
      } else {
        // if site root (e.g. / or /repo), just use /image/id
        newPath = base + (base === '' || base === '/' ? '' : '/') + 'image/' + encodeURIComponent(id);
      }
      try { history.replaceState({}, '', newPath); } catch(e) { /* ignore */ }
    }
  }

  // initial load
  const initialId = getImageIdFromLocation() || Object.keys(imagesData)[0];
  setViewForId(initialId, true);

  // prev/next click handlers (navigate by changing location to /image/{id})
  prevBtn.addEventListener('click', () => {
    const current = normalizeId(metaId.textContent);
    if (/^\d+$/.test(current)) {
      const prev = String(parseInt(current,10) - 1);
      if (imagesData[prev]) {
        // navigate to same site path /image/{prev}
        const newUrl = buildImageUrl(prev);
        location.href = newUrl;
      }
    }
  });
  nextBtn.addEventListener('click', () => {
    const current = normalizeId(metaId.textContent);
    if (/^\d+$/.test(current)) {
      const next = String(parseInt(current,10) + 1);
      if (imagesData[next]) {
        const newUrl = buildImageUrl(next);
        location.href = newUrl;
      }
    }
  });

  // build URL for /image/{id} that is safe for GitHub Pages (keeps repo path if present)
  function buildImageUrl(id) {
    const parts = location.pathname.split('/').filter(Boolean);
    // if current contains 'image', replace the segment's next value
    const idx = parts.indexOf('image');
    let base;
    if (idx >= 0) {
      // keep everything up to 'image'
      base = '/' + parts.slice(0, idx).join('/');
      if (base === '/') base = '';
      return (base || '') + '/image/' + encodeURIComponent(id);
    } else {
      // simply append image/id to current path (or root)
      const basePath = location.pathname.replace(/\/+$/,'');
      return basePath + (basePath === '' || basePath === '/' ? '' : '/') + 'image/' + encodeURIComponent(id);
    }
  }

// fullscreen button handler
const fullscreenBtn = document.getElementById('fullscreenBtn');
fullscreenBtn.addEventListener('click', () => {
  const img = mainImage;
  if (!img) return;
  if (document.fullscreenElement) {
    document.exitFullscreen();
  } else {
    if (img.requestFullscreen) img.requestFullscreen();
    else if (img.webkitRequestFullscreen) img.webkitRequestFullscreen();
    else if (img.msRequestFullscreen) img.msRequestFullscreen();
  }
});


  // download helper: attempt anchor download; if CORS prevents, try fetching blob
  downloadBtn.addEventListener('click', () => {
  const src = mainImage.src;
  if (!src) return;

  const a = document.createElement('a');
  a.href = src; // relative path works fine
  a.download = (metaTitle.textContent || 'image') + '.jpg';
  document.body.appendChild(a);
  a.click();
  a.remove();
});

  // back to previous screen (history)
  backScreen.addEventListener('click', () => {
    if (history.length > 1) history.back();
    else window.location.href = '/'; // fallback to home
  });

  // keyboard navigation
  window.addEventListener('keydown', (ev) => {
    if (ev.key === 'ArrowLeft') prevBtn.click();
    if (ev.key === 'ArrowRight') nextBtn.click();
    if (ev.key === 'Escape') backScreen.click();
  });

  /***********************
   * Optional: small animated hex canvas background
   * (same approach as your provided script but simplified)
   ***********************/
  (function(){
    const canvas = document.getElementById('bg-canvas');
    if (!canvas) return;
    const ctx = canvas.getContext('2d');
    let width = canvas.width = window.innerWidth;
    let height = canvas.height = window.innerHeight;
    let mouse = { x: -1000, y: -1000 };
    let bgOffsetX = 0, bgOffsetY = 0;
    const r = 48;
    const colSpacing = Math.sqrt(3) * r;
    const rowSpacing = 1.5 * r;
    const strokeColor = 'rgba(57,211,83,0.10)';
    const lineWidth = 1.4;
    let ripples = [];

    function drawHex(x,y,radius){
      ctx.beginPath();
      for(let i=0;i<6;i++){
        const angle = Math.PI/6 + i*Math.PI/3;
        const px = x + radius*Math.cos(angle);
        const py = y + radius*Math.sin(angle);
        if (i===0) ctx.moveTo(px,py); else ctx.lineTo(px,py);
      }
      ctx.closePath();
      ctx.strokeStyle = strokeColor;
      ctx.lineWidth = lineWidth;
      ctx.stroke();
    }

    function draw(){
      ctx.clearRect(0,0,width,height);
      const startCol = Math.floor(-bgOffsetX/colSpacing)-2;
      const endCol = Math.ceil((width-bgOffsetX)/colSpacing)+2;
      const startRow = Math.floor(-bgOffsetY/rowSpacing)-2;
      const endRow = Math.ceil((height-bgOffsetY)/rowSpacing)+2;
      for(let row=startRow; row<endRow; row++){
        const rowOffset = (row%2!==0) ? colSpacing/2 : 0;
        for(let col=startCol; col<endCol; col++){
          const baseX = col*colSpacing + rowOffset + bgOffsetX;
          const baseY = row*rowSpacing + bgOffsetY;
          let adjX = baseX, adjY = baseY;
          const dx = baseX - mouse.x, dy = baseY - mouse.y;
          const dist = Math.sqrt(dx*dx + dy*dy);
          if (dist < 140){
            const force = (1 - dist/140) * 3.5;
            adjX += Math.sin(dy/18) * force;
            adjY += Math.cos(dx/18) * force;
          }
          ripples.forEach(rp=>{
            const dxr = baseX - rp.x, dyr = baseY - rp.y;
            const dR = Math.sqrt(dxr*dxr + dyr*dyr);
            if (dR < 200){
              const f = (1 - dR/200)*rp.strength;
              adjX += Math.sin(dyr/20)*f;
              adjY += Math.cos(dxr/20)*f;
            }
          });
          drawHex(adjX, adjY, r);
        }
      }
    }

    function animate(){
      bgOffsetX += 0.08;
      bgOffsetY += 0.04;
      draw();
      ripples = ripples.filter(r=>{ r.strength -= 0.45; return r.strength > 0; });
      requestAnimationFrame(animate);
    }
    animate();

    document.addEventListener('mousemove', e => { mouse.x = e.clientX; mouse.y = e.clientY; });
    document.addEventListener('mouseleave', () => { mouse.x = -1000; mouse.y = -1000; });
    document.addEventListener('click', e => { ripples.push({ x: e.clientX, y: e.clientY, strength: 16 }); });
    window.addEventListener('resize', () => { width = canvas.width = window.innerWidth; height = canvas.height = window.innerHeight; });
  })();

downloadBtn.addEventListener('click', async () => {
  const src = mainImage.src;
  if (!src) return;

  try {
    // fetch the image as blob
    const res = await fetch(src, {mode: 'cors'});
    if (!res.ok) throw new Error('Failed to fetch');
    const blob = await res.blob();
    const url = URL.createObjectURL(blob);

    // create temporary anchor to trigger download
    const a = document.createElement('a');
    a.href = url;
    a.download = (metaTitle.textContent || 'image') + '.jpg';
    document.body.appendChild(a);
    a.click();
    a.remove();

    URL.revokeObjectURL(url);
  } catch (err) {
    alert('Download failed. Remote server may block downloads.');
  }
});

  </script>
</body>
</html>